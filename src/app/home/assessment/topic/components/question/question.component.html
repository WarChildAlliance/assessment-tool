<!--<app-header></app-header>-->
<div class="light-yellow-bg" *ngIf="question; else questionNotAvailable">
    <div class="progress_bar">
        <img class="pointer" (click)="onPrevious()"
            [src]=" translate.currentLang === 'ara' ? 'assets/icons/right_arrow_24.svg' :  'assets/icons/left_arrow_24.svg'">
        <mat-progress-bar mode="determinate" [value]="questionIndex / topic.questions.length * 100">
        </mat-progress-bar>
        <div class="icons">
            <img *ngIf="assessment.icon" [src]="getSource(assessment.icon)">
            <img *ngIf="topic.icon" [src]="getSource(topic.icon)">
        </div>
    </div>

    <div [@popOverState]="stateName" *ngIf="question.on_popup" style="padding: 2em;">
        <!-- When opening question in modal: button to reopen it if the student tries to return to topics but gives up -->
        <app-primary-btn [text]="('general.reopen' | translate)"
            iconUrl="assets/icons/check_24.svg" width="60%"
            (click)="openQuestionModal()" class="main-btn submit">
        </app-primary-btn>
    </div>
    
    <div class="question" [@popOverState]="stateName" *ngIf="!question.on_popup">
        <h2 class="question-title">{{ question.title }}</h2>
        <div class="question-attachment">
            <app-attachments [attachments]="question.attachments"></app-attachments>
        </div>

        <div class="question-content">

            <ng-container *ngIf="question.question_type === 'INPUT'">
                <app-question-input [question]="question" [(answer)]="answer"
                    [displayCorrectAnswer]="displayCorrectAnswer">
                </app-question-input>
            </ng-container>

            <ng-container *ngIf="question.question_type === 'NUMBER_LINE'">
                <app-question-number-line [question]="question" [(answer)]="answer"
                    [displayCorrectAnswer]="displayCorrectAnswer"></app-question-number-line>
            </ng-container>

            <ng-container *ngIf="question.question_type === 'SELECT'">
                <app-question-select [question]="question" [(answer)]="answer"
                    [displayCorrectAnswer]="displayCorrectAnswer" [isEvaluated]="isEvaluated"></app-question-select>
            </ng-container>

            <ng-container *ngIf="question.question_type === 'SORT'">
                <app-question-sort [question]="question" [(answer)]="answer"
                    [displayCorrectAnswer]="displayCorrectAnswer">
                </app-question-sort>
            </ng-container>

        </div>

        <div class="question-buttons">
            <app-primary-btn *ngIf="!displayCorrectAnswer.getValue()"
                [text]="(!this.answer && this.topic.allow_skip) ? ('general.skip' | translate) : ('general.submit' | translate)"
                iconUrl="assets/icons/check_24.svg" width="60%" [isDisabled]="!topic.allow_skip && !answer"
                (click)="submitSkipQuestion()" class="main-btn submit">
            </app-primary-btn>
    
            <app-primary-btn *ngIf="displayCorrectAnswer.getValue()" [text]="'topics.question.continue' | translate" [iconUrl]="translate.currentLang === 'ara' ?
                            'assets/icons/left_arrow_24.svg' : 'assets/icons/right_arrow_24.svg'" width="60%"
                (click)="submitAnswerAndGoNextPage()" class="main-btn submit">
            </app-primary-btn>
        </div>

    </div>

</div>


<ng-template #questionNotAvailable>
    <div>
        {{ 'topics.question.questionNotAvailable' | translate }}
    </div>
</ng-template>

<!-- To open question in modal -->
<ng-template #questionDialog>
    <div class="question-popup">
        <h2 class="question-title">{{ question.title }}</h2>
        <div class="question-attachment">
            <app-attachments [attachments]="question.attachments"></app-attachments>
        </div>
        <!-- Gobee avatar: TODO check design -->
        <img src="assets/icons/flying-bee.svg" style="padding: 1em;"/>

        <div class="question-content">
            <ng-container *ngIf="question.question_type === 'INPUT'">
                <app-question-input [question]="question" [(answer)]="answer"
                    [displayCorrectAnswer]="displayCorrectAnswer">
                </app-question-input>
            </ng-container>

            <ng-container *ngIf="question.question_type === 'NUMBER_LINE'">
                <app-question-number-line [question]="question" [(answer)]="answer"
                    [displayCorrectAnswer]="displayCorrectAnswer"></app-question-number-line>
            </ng-container>

            <ng-container *ngIf="question.question_type === 'SELECT'">
                <app-question-select [question]="question" [(answer)]="answer"
                    [displayCorrectAnswer]="displayCorrectAnswer" [isEvaluated]="isEvaluated"></app-question-select>
            </ng-container>

            <ng-container *ngIf="question.question_type === 'SORT'">
                <app-question-sort [question]="question" [(answer)]="answer"
                    [displayCorrectAnswer]="displayCorrectAnswer">
                </app-question-sort>
            </ng-container>
        </div>

        <div class="buttons">
            <app-primary-btn *ngIf="!displayCorrectAnswer.getValue()"
                [text]="(!this.answer && this.topic.allow_skip) ? ('general.skip' | translate) : ('general.submit' | translate)"
                iconUrl="assets/icons/check_24.svg" width="60%" [isDisabled]="!topic.allow_skip && !answer"
                (click)="submitSkipQuestion()" class="main-btn submit">
            </app-primary-btn>
    
            <app-primary-btn *ngIf="displayCorrectAnswer.getValue()" [text]="'topics.question.continue' | translate" [iconUrl]="translate.currentLang === 'ara' ?
                            'assets/icons/left_arrow_24.svg' : 'assets/icons/right_arrow_24.svg'" width="60%"
                (click)="submitAnswerAndGoNextPage()" class="main-btn submit" mat-dialog-close>
            </app-primary-btn>
        </div>
    </div>
</ng-template>