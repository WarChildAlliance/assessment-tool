<!--<app-header></app-header>-->
<div class="light-green-bg" *ngIf="question; else questionNotAvailable">
    <div class="header">
        <img class="elevated-valid" (click)="onPrevious()"
            [src]="translate.currentLang === 'ara' ? 'assets/icons/right_arrow_24.svg' :  'assets/icons/left_arrow_24.svg'">
        <div class="progress-header">
            <!--  flyingBee = 35px so the bee stays before the first question path -->
            <div class="progress-bar" #progressBar [style.width]="(topic.questions.length  * path + flyingBee) + 'px'"> 
                <svg  width="36px" *ngFor="let question of topic.questions; let i=index" height="0.35em"   fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path [style.stroke]="questionIndex > i ? '#70504a' : 'white'" stroke-width="2" stroke-dasharray="4 4"
                    d="M0 0C0 2.65216 1.89076 5.1957 5.25632 7.07107C8.62189 8.94643 13.1866 10 17.9462 10C22.7058 10 27.2705 8.94643 30.6361 7.07107C34.0017 5.1957 35.8924 2.65216 35.8924 0"/>
                </svg>
                <img *ngIf="translate.currentLang !== 'ara'" [style.left]="(questionIndex * path) + 'px'" class="bee" [src]="'/assets/icons/flying-bee-right.svg'">
                <img *ngIf="translate.currentLang === 'ara'" [style.left]="((topic.questions.length - questionIndex) * path) + 'px'" class="bee" [src]="'/assets/icons/flying-bee.svg'">
            </div>
            <div class="icons">
                <!-- only using topic icon for now, it'll change to the flower the children choose  -->
                <!-- <img *ngIf="assessment.icon" [src]="getSource(assessment.icon)"> -->
                <img *ngIf="topic.icon" [src]="getSource(topic.icon)">
            </div>
        </div>
    </div>

    <div [@popOverState]="stateName" *ngIf="question.on_popup" style="padding: 2em;">
        <!-- When opening question in modal: button to reopen it if the student tries to return to topics but gives up -->
        <app-action-btn [text]="('general.reopen' | translate)"
            iconUrl="assets/icons/check_24.svg" width="60%"
            (click)="openQuestionModal()" class="main-btn submit">
        </app-action-btn>
    </div>

    <div class="question" [@popOverState]="stateName" *ngIf="!question.on_popup">
        <h2 *ngIf="question.question_type !== 'NUMBER_LINE'" class="question-title">{{ question.title }}</h2>
        <div class="question-attachment">
            <app-attachments [attachments]="question.attachments"></app-attachments>
        </div>

        <div class="question-container">
            <div class="question-content">
                <ng-container *ngIf="question.question_type === 'SEL'">
                    <app-question-sel [question]="question" [(answer)]="answer"
                        (answerChange)="submitQuestion()"
                        [displayCorrectAnswer]="displayCorrectAnswer">
                    </app-question-sel>
                </ng-container>

                <ng-container *ngIf="question.question_type === 'INPUT'">
                    <app-question-input [question]="question" [(answer)]="answer"
                        [displayCorrectAnswer]="displayCorrectAnswer">
                    </app-question-input>
                </ng-container>
    
                <ng-container *ngIf="question.question_type === 'NUMBER_LINE'">
                    <app-question-number-line [question]="question" [answer]="answer"
                        (answerChange)="checkAnswer($event)" [resetAnswer]="resetAnswer"
                        [displayCorrectAnswer]="displayCorrectAnswer">
                    </app-question-number-line>
                </ng-container>
    
                <ng-container *ngIf="question.question_type === 'SELECT'">
                    <app-question-select [question]="question" [answer]="answer" 
                        (answerChange)="checkAnswer($event)" [resetAnswer]="resetAnswer"
                        [displayCorrectAnswer]="displayCorrectAnswer" [isEvaluated]="isEvaluated">
                    </app-question-select>
                </ng-container>
    
                <ng-container *ngIf="question.question_type === 'SORT'">
                    <app-question-sort [question]="question" [(answer)]="answer"
                        [displayCorrectAnswer]="displayCorrectAnswer">
                    </app-question-sort>
                </ng-container>
    
                <ng-container *ngIf="question.question_type === 'DRAG_AND_DROP'">
                <app-question-drag-and-drop
                    [assessmentId]="assessment.id"
                    [topicId]="topic.id"
                    [question]="question"
                    [answer]="answer"
                    (answerChange)="checkAnswer($event)"
                    [resetAnswer]="resetAnswer"
                    [displayCorrectAnswer]="displayCorrectAnswer">
                >
                </app-question-drag-and-drop>
            </ng-container>

        </div>

        <div class="question-buttons" *ngIf="isQuestionInput">
            <app-action-btn [text]="('general.submit' | translate)" (click)="submitQuestion()" class="main-btn submit"
                iconUrl="assets/icons/check_24.svg" width="60%" [isDisabled]="!answer">
            </app-action-btn>
        </div>
    </div>
</div>

<ng-template #questionNotAvailable>
    <div>
        {{ 'topics.question.questionNotAvailable' | translate }}
    </div>
</ng-template>

<!-- To open question in modal -->
<ng-template #questionDialog>
    <div class="question-popup">
        <h2 class="question-title">{{ question.title }}</h2>
        <div class="question-attachment">
            <app-attachments [attachments]="question.attachments"></app-attachments>
        </div>
        <!-- Gobee avatar: TODO check design -->
        <img src="assets/icons/flying-bee.svg" style="padding: 1em;"/>

        <div class="question-content">
            <ng-container *ngIf="question.question_type === 'SEL'">
                <app-question-sel [question]="question" [(answer)]="answer"
                    (answerChange)="submitQuestion()"
                    [displayCorrectAnswer]="displayCorrectAnswer">
                </app-question-sel>
            </ng-container>

            <ng-container *ngIf="question.question_type === 'INPUT'">
                <app-question-input [question]="question" [(answer)]="answer"
                    [displayCorrectAnswer]="displayCorrectAnswer">
                </app-question-input>
            </ng-container>

            <ng-container *ngIf="question.question_type === 'NUMBER_LINE'">
                <app-question-number-line [question]="question" [answer]="answer"
                    (answerChange)="checkAnswer($event)" [resetAnswer]="resetAnswer"    
                    [displayCorrectAnswer]="displayCorrectAnswer">
                </app-question-number-line>
            </ng-container>

            <ng-container *ngIf="question.question_type === 'SELECT'">
                <app-question-select [question]="question" [answer]="answer"
                    (answerChange)="checkAnswer($event)" [resetAnswer]="resetAnswer"
                    [displayCorrectAnswer]="displayCorrectAnswer" [isEvaluated]="isEvaluated">
                </app-question-select>
            </ng-container>

            <ng-container *ngIf="question.question_type === 'SORT'">
                <app-question-sort [question]="question" [(answer)]="answer"
                    [displayCorrectAnswer]="displayCorrectAnswer">
                </app-question-sort>
            </ng-container>

            <ng-container *ngIf="question.question_type === 'DRAG_AND_DROP'">
                <app-question-drag-and-drop
                    [assessmentId]="assessment.id"
                    [topicId]="topic.id"
                    [question]="question"
                    [answer]="answer"
                    (answerChange)="checkAnswer($event)"
                    [resetAnswer]="resetAnswer"
                    [displayCorrectAnswer]="displayCorrectAnswer">>
                </app-question-drag-and-drop>
            </ng-container>
        </div>

        <div class="buttons" *ngIf="isQuestionInput">
            <app-action-btn [text]="('general.submit' | translate)" (click)="submitQuestion()" class="main-btn submit"
                iconUrl="assets/icons/check_24.svg" width="60%" [isDisabled]="!answer">
            </app-action-btn>
        </div>
    </div>
</ng-template>